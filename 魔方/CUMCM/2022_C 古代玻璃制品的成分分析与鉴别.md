>[!note] ==论文提醒==
>1. 可以在每一问前画出一张流程图。
>2. 将变量列到一张表中。
>3. 代码存储于CUMCM/2022_C中.
>4. 由于github中Markdown文件中无法直接插入数据，我在这个文档中仅仅给出数据名称，数据请到‘文件’中查询。

## 一、第一问
本问主要可以划分：
1. 探寻表面风化与几种性状之间的联系。
2. 根据种类统计风化前后化学成分的变化。
3. 还原玻璃风化前的成分数据。
### （一）、表面风化与性状之间的联系

  首先将数据可视化，其中蓝色代表风化，红色代表未风化，以下是三种性状对风化影响的统计结果。
   
   ![交叉图1](https://github.com/HITwh-224/Math/blob/main/%E9%AD%94%E6%96%B9/%E5%9B%BE%E7%89%87/%E4%BA%A4%E5%8F%89%E5%9B%BE%201.png?raw=true)
   ![交叉图2.png](https://github.com/HITwh-224/Math/blob/main/%E9%AD%94%E6%96%B9/%E5%9B%BE%E7%89%87/%E4%BA%A4%E5%8F%89%E5%9B%BE2.png?raw=true)
   ![交叉图3.png](https://github.com/HITwh-224/Math/blob/main/%E9%AD%94%E6%96%B9/%E5%9B%BE%E7%89%87/%E4%BA%A4%E5%8F%89%E5%9B%BE3.png?raw=true)
   
   >[!note] 论文建议
   >可以想想将这三个图如何布局
   
   
   分析可知，本问的目的是分析风化与性状之间是否两两独立， 为此，我们使用[[卡方检验与fisher精确检验#卡方检验]]来计算两者之间的独立性，但卡方检验在面临样本量较少的情况时可能会出现精度不足的情况，因此，我们引入fisher精确检验来佐证卡方检验的结果。fisher精确检验特别试用于样本量较小的情况，但其在大样本的情况下，检验的准确性会下降。
 因此，我们将卡方检验与fisher精确检验相结合，可以尽可能避免因样本量而导致的误差。

![fisher精确检验.xlsx]

>[!note] ==论文提示==
>将这个表格数据完全展示，主要其中颜色的区别。

首先，设定原假设“风化与性状无关”的显著性水平为0.05，通过spss计算，得到了卡方检验与fisher精确检验的结果：

>[!note] 检验结果
> - 纹饰与风化
>  卡方检验与fisher检验的p值都大于0.05，原假设成立，风化与纹饰种类无关。
>  - 颜色与风化
>   同样p值都大于0.05，颜色与风化无关。
>   - 类型与风化
>   卡方检验与fisher检验的p值都显著小于0.05，原假设被推翻，类型与风化相关。


### （二）、风化前后化学成分的变化

通过上文可知，颜色与纹饰都不会对风化产生特别的影响，只有玻璃类型是影响风化的关键，因此，对于同种类型不同样本的玻璃，我们可以将其视作同一个体进行分析。
有了这个结论，首先将玻璃分为高钾类与铅钡类两种，分别对两种玻璃进行分析，这个问题实际上就变成了一个**单因素变化问题**：*对于几个相同的样本，只有是否风化这个因素影响了其成分变化。*


[[方差检验（F检验）#^9843b6]] 中的单因素方差分析专门用来解决由于单因素变化导致的各项指标变化是否显著的问题，但进行方差检验的前提是数据需要满足正态分布，题目提供数据只是简单的百分比数据，显然不满足要求，因此，我们对数据进行中心化对数变化（CLR），它可以将比例数据转变为满足正态分布的数据。其公式如下：

![Pasted image 20250126111937.png](https://github.com/HITwh-224/Math/blob/main/%E9%AD%94%E6%96%B9/%E5%9B%BE%E7%89%87/Pasted%20image%2020250126111937.png?raw=true)
```latex
\begin{aligned}
CLR(x)=(ln\frac{x_1}{g(x)},ln\frac{x_2}{g(x)},...ln\frac{x_n}{g(x)}) \\
g(x)=\exp(\frac{1}{n}\sum_{i=1}^nlnx_n)
\end{aligned}
```

其中x为各项成分比例，g(x)为x的几何平均数。
在完成数据处理后，我们将铅钡类与高钾类样本分别进行检验，以下是检验过程：
#### 1. 高钾类
我们将风化样本归类于样本组1，未风化类为样本组2，通过spss对其进行单因素方差检验，设定显著性水平为0.05，得到了以下结果:

![单因素方差分析.xlsx]

>[!note] ==论文提示==
>仅展示显著性，将其列为一张表格

>[!note] 检验结果
>观察数据，发现只有二氧化硅(SIO2)的显著性小于0.05，判定其数量变化与风化显著相关，而氧化钾（K2O)与氧化铜(CUO)的检验结果极为接近0.05，判定其成分变化与风化有一定关联。

通过平均值图，我们可以直观的看到风化前后化学成分含量的变化（1为风化，2为未风化）：
![SIO2平均值图.png](https://github.com/HITwh-224/Math/blob/main/%E9%AD%94%E6%96%B9/%E5%9B%BE%E7%89%87/SIO2%E5%B9%B3%E5%9D%87%E5%80%BC%E5%9B%BE.png?raw=true)
![K2O平均值图.png](https://github.com/HITwh-224/Math/blob/main/%E9%AD%94%E6%96%B9/%E5%9B%BE%E7%89%87/K2O%E5%B9%B3%E5%9D%87%E5%80%BC%E5%9B%BE.png?raw=true)
![CUO平均值图.png](https://github.com/HITwh-224/Math/blob/main/%E9%AD%94%E6%96%B9/%E5%9B%BE%E7%89%87/CUO%E5%B9%B3%E5%9D%87%E5%80%BC%E5%9B%BE.png?raw=true)


>[!note] 论文提示
>将这三张图合为一张。

>[!note] 观察结果
>通过观察，我们看到，在风化后，二氧化硅与氧化铜的含量显著上升，氧化钾的含量显著下降。

#### 2. 铅钡类
同理，我们对铅钡类进行检验，得到了以下结果。
![单因素方差分析铅钡.xlsx]
>[!note] ==论文提示==
>与上文同理

>[!note] 观察结果
>对结果进行分析，我们发现，二氧化硅，氧化钠，氧化钾，氧化钙，氧化铝，氧化铅，五氧化二磷的显著性都小于0.05，判定它们成分的变化与风化显著相关。

下面，我们通过平均值图来分析其风化前后成分含量的变化趋势。
![SIO2.png](https://github.com/HITwh-224/Math/blob/main/%E9%AD%94%E6%96%B9/%E5%9B%BE%E7%89%87/SIO2.png?raw=true)

![na2o.png](https://github.com/HITwh-224/Math/blob/main/%E9%AD%94%E6%96%B9/%E5%9B%BE%E7%89%87/na2o.png?raw=true)

![k2o.png](![image](https://github.com/user-attachments/assets/adadd6de-6f2f-4615-9d80-2b6e57559064)
)

![cao.png](https://github.com/HITwh-224/Math/blob/main/%E9%AD%94%E6%96%B9/%E5%9B%BE%E7%89%87/cao.png?raw=true)

![al2o3.png](https://github.com/HITwh-224/Math/blob/main/%E9%AD%94%E6%96%B9/%E5%9B%BE%E7%89%87/al2o3.png?raw=true)
![pbo.png](https://github.com/HITwh-224/Math/blob/main/%E9%AD%94%E6%96%B9/%E5%9B%BE%E7%89%87/pbo.png?raw=true)
![p2o5.png](https://github.com/HITwh-224/Math/blob/main/%E9%AD%94%E6%96%B9/%E5%9B%BE%E7%89%87/p2o5.png?raw=true)

>[!note] ==论文提示==
>将其合并为一到两张图片

>[!note] 观察结果
>风化会引起SIO2,NA2O,K2O,AL2O3成分的减小，CAO,PBO,P2O5成分的增加。


### （三）风化前的成分预测
查阅文献，我们发现中心化对数变化（CLR)后的数据近似还原是预测化学成分的重要方法，已知变化后的数据近似的服从正态分布，设定CLR(X)为风化数据，CLR(Y)为未风化数据，通过以下公式，我们可以将风化数据还原为为风化数据。
![Pasted image 20250128090833.png](https://github.com/HITwh-224/Math/blob/main/%E9%AD%94%E6%96%B9/%E5%9B%BE%E7%89%87/Pasted%20image%2020250128090833.png?raw=true)
```latex
\left.\left\{
\begin{array}
{l}CLR(X)\sim N(\mu_x,\sigma_x^2) \\
CLR(Y)\sim N(\mu_y,\sigma_y^2) \\
CLR(Y)=\mu_y+\frac{\sigma_y}{\sigma_x}(CLR(X)-\mu_x)
\end{array}\right.\right.
```

通过matlab,我们得到了以下结果:
![还原后数据.xlsx]

>[!note] ==论文提示==
>选择一些数据展示，不用全部。

## 二、 第二问
题目要求我们找到合理的方法划分大类与亚类，并对其敏感性进行检验。
### （一）、大类划分
#### 1. 随机森林确定主要性状
为了更好衡量各项数据在大分类中的重要程度，我们采用随机森林（Random Forest)的方法进行数据重要性测量，[[随机森林#一、简介]]（Random Forest）是一种集成学习方法，它通过构建多个决策树并进行投票来提高预测的准确性和稳定性，这些决策树通过随机从给定性状中抽取几样作为评判标准进行判断，最后根据投票原则确定结果。在模型训练完毕后，我们找出做出正确投票的决策树，统计它们评判标准的共同性状的出现频率，以此确定不同性状的重要性。
通过spss设置随机森林模型，设定决策树数量为100，采用有放回抽样策略，为了防止过拟合，设定树的深度为10，叶子节点的最大数量为50，节点分裂的最小样本数为2，使用基尼系数作为节点评判标准。我们得到了大类划分中各化学成分的重要性：
![特征重要性图 1.png](https://github.com/HITwh-224/Math/blob/main/%E9%AD%94%E6%96%B9/%E5%9B%BE%E7%89%87/%E7%89%B9%E5%BE%81%E9%87%8D%E8%A6%81%E6%80%A7%E5%9B%BE%201.png?raw=true)

>[!note] 结果分析
>通过数据，我们发现氧化铅，氧化钡，氧化钾是划分大类的重要性状。


#### 2. 支持向量机分类
通过随机森林确定主要性状后，我们通过主要性状作为分类依据，通过支持向量机进行分类。支持向量机是一种用于分类和回归分析的机器学习算法，对这种性状数据的划分十分有效。 
由于数据集为单点非连续函数，我们认为数据是线性可分的，采用liner作为核函数；防止过拟合，设置最大迭代次数为1000；设置惩罚系数为1，误差收敛系数为0.001；训练集比例为0.7。
完成参数设置后，我们进行模型训练，得到了以下结果，由于篇幅原因，仅给出预测集训练数据：![[预测集数据.csv]]

模型的参数数据存储在![[模型数据.xlsx]]

我们看到，模型的精确度为1，这代表我们的模型可以实现100%的大类划分精确度，具有优良的划分能力。

#### 3. 模型检验
在上文中，为了保证数据的可靠性，仅使用了未风化的数据作为训练样本，但在实际生活中，我们可能会面临风化玻璃划分的问题，因此，我们使用风化玻璃数据对我们的模型进行检验，得到了以下结果：![[风化数据.xlsx]]
可以发现，我们的模型在面对风化后数据的划分是，依然检验100%的准确性，因此我们认为模型具有良好的抗干扰性，可以满足实际的工作需求。

### （二）、亚类分析
#### 1. 高钾类
对于亚类，我们使用系统聚类的方法进行划分，[[系统聚类]]在初始状态时，将数据中的每一个样本作为单独的类，通过欧式距离计算各样本之间的相似性，逐渐将各样本合并为几个大类，并通过谱系图表示出来。
![聚类图.png](![image](https://github.com/user-attachments/assets/ff47bdf9-6209-4e5e-b82e-6a23fe7ec077)
)
通过观察，我们认为将高钾类样本分为两个大类最为合适，以下是分类后数据：
![高钾分类数据（还原后）.xlsx]

对样本进行聚类后，我们再次通过随机森林对划分结果进行分析，得到划分性状重要性排序：
![特征重要性图 (1).png](https://github.com/HITwh-224/Math/blob/main/%E9%AD%94%E6%96%B9/%E5%9B%BE%E7%89%87/%E7%89%B9%E5%BE%81%E9%87%8D%E8%A6%81%E6%80%A7%E5%9B%BE%20(1).png?raw=true)

>[!note] 结果分析
>性状重要性表面，氧化锶，氧化锡，氧化钙是划分性状的重要依据。


| 高钙、锡、锶玻璃 | 03部位2 \|04\| \|05\| \|06部位1\| \|06部位2\| \|13\| \|14\| \|16\| 07 27 22 21 09 |
| -------- | --------------------------------------------------------------------------- |
| 低钙、锡、锶玻璃 | 18 10                                                                       |

#### 2. 铅钡类
同理，我们同样使用系统聚类的方法对铅钡样本进行分类，得到如下谱系图：
![谱系图 1 1.png](https://github.com/HITwh-224/Math/blob/main/%E9%AD%94%E6%96%B9/%E5%9B%BE%E7%89%87/%E8%B0%B1%E7%B3%BB%E5%9B%BE%201%201.png?raw=true)
以下是聚类结果：
![铅钡数据（还原后）.xlsx]

>[!note] ==论文提示==
>仅展示分类结果即可，不用展示其他数据。

我们使用随机森林进行重要度排序，得到了以下结果：
![特征重要性图 1.png](https://github.com/HITwh-224/Math/blob/main/%E9%AD%94%E6%96%B9/%E5%9B%BE%E7%89%87/%E7%89%B9%E5%BE%81%E9%87%8D%E8%A6%81%E6%80%A7%E5%9B%BE%201.png?raw=true)
>[!note] 结论分析
>我们发现，氧化钠、五氧化二磷是划分铅钡亚类的重要依据。


| 高钠低磷 | \|02\|     \|39\| \|40\| 41\|  \|08\| \|08严重风化点\| \|11\| \|19\| \|26\| \|26严重风化点\| \|34 \|43部位2\| \|49\| \|50\| \|51部位1\| \|51部位2\| \|52\| 54\| \|54严重风化点\| \|56\| \|57\| \|58\| \|20\| \|23未风化点\| \|24\|<br>\|25未风化点\| \|28未风化点\| \|29未风化点\| \|30部位1\| \|30部位2\| \|31\| \|32\| \|33\| \|35\| \|37\|<br>\|42未风化点1\| \|42未风化点2\| \|44未风化点\| \|45\| \|46\| \|47\| \|49未风化点\|  \|50未风化点\| |
| ---- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 低钠高磷 | 54严重风化点\|                                                                                                                                                                                                                                                                                                                                                                              |
| 低钠低磷 | \|36\|\|38\|\|39\|\|40\|\|41\|\|43部位1\|\|43部位2\|\|48\|\|49\|\|50\|\|51部位1\|\|51部位2\|52\|\|54\|\|54严重风化点\|<br>\|56\|\|57\|58\|\|20\|\|23未风化点\|\|24\|\|25未风化点\|\|28未风化点\|\|29未风化点\|\|30部位1\|\|30部位2\|<br>\|31\|\|32\|\|33\|\|35\|\|37\|\|42未风化点1\|\|42未风化点2\|\|44未风化点\|\|45\|\|46\|\|47\|\|49未风化点\|<br>\|50未风化点\|\|53未风化点\|\|55\|                                                        |

## 三、第三问
### 1. 大类划分
为了论证其敏感性，我们将实验数据进行(CLR)后，对风化数据进行还原，分别将其风化前后数据都带入支持向量机进行分类，得到了相同的结果，因此，我们认为实验结果是稳定的。
![划分结果.csv]

以上是划分结果

### 2. 亚类划分
将数据带入先前的系统聚类中，分别得到了其谱系图：
1. **高钾**：
![谱系图 2.png](https://github.com/HITwh-224/Math/blob/main/%E9%AD%94%E6%96%B9/%E5%9B%BE%E7%89%87/%E8%B0%B1%E7%B3%BB%E5%9B%BE%202.png?raw=true)

| 高钙、锡、锶玻璃 | A1 A6 A7 |
| -------- | -------- |




2. **铅钡** 
![谱系图 1 1.png](https://github.com/HITwh-224/Math/blob/main/%E9%AD%94%E6%96%B9/%E5%9B%BE%E7%89%87/%E8%B0%B1%E7%B3%BB%E5%9B%BE%201%201.png?raw=true)

| 高钠低磷 | A2 A3 A4 A5 A8 |
| ---- | -------------- |

## 四、 第四问
要求我们根据不同类别的数据，分析各项化学成分之间的联系，我们使用spearman相关性分析对两两化学成分之间是否独立进行分析。
### 1. 高钾类
使用matlab进行进行分析，我们将相关数据以热力图的形式进行展示：
![hotmap.png](https://github.com/HITwh-224/Math/blob/main/%E9%AD%94%E6%96%B9/%E5%9B%BE%E7%89%87/hotmap.png?raw=true)

>[!note] 结果分析
>SiO2与Al0、SnOz之间存在正相关，与FeO 之间存在负相关：Na,0与P205之间存在负相关：SrO 写CaO 之间存在负相关：SnO2与CuO、FenOs存在负相关：SOz与BaO、PbO 存在负相关：Fex0s与CuO 存在正相关


### 2. 铅钡类
![hotmap 1.png](https://github.com/HITwh-224/Math/blob/main/%E9%AD%94%E6%96%B9/%E5%9B%BE%E7%89%87/hotmap%201.png?raw=true)

>[!note] 结果分析
>SiO2与PbO 之间存在正相关，与SrO 之间存在负相关：Na.0 与Fe20g、P205、SnO2存在负相关：K20 和Al0s存在正相关，和CaO 存在负相关；CaO 与CuO、BaO 存在负相关；MgO 与SO存在负相关；Fe20s与CuO 存在负相关；CuO 与BaO 存在正相关、与SnO负相关：PbO与BaO 正相关。


### 3.两者之间的联系
>[!note] 结果分析
>Fe0s与CuO 存在正相关，而铅钡玻璃则相反

## 五、代码
详见此处[2022_C 代码]
